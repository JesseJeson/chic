---
title: 单调队列优化多重背包
date: 2022-07-15 09:56:37
tags:
- oi
- 多重背包
categories:
- oi
---

# 为什么可以用单调队列优化

## 符号定义

首先我们定义一些符号，物品个数为 $n$ ，
第 $i$ 个物品的体积为 $v_i$ ，价值为 $w_i$ , 最多为 $s_i$ 个。
背包的体积为 $V$，动归数组为 $dp$ .

## 回顾

我们先回顾多重背包的优化，（ $x$ 是 背包体积为 $j$ 时，背包能够承受的最大个数，即 $j / v$）
设此时第 $i$ 个物品的体积为 $v$ .

$$
dp[i, j]= max(dp[i - 1, j], dp[i - 1, j - v] + w, dp[i - 1, j - 2v] + 2w, ......,dp[i - 1, j - (x - 1) v] + (x - 1)w, dp[i - 1, j - xv] + xw)
$$

然后我们来思考，完全背包时，$dp[i,j]$ 和 $dp[i,j - v]$ 的联系

$$
dp[i, j - v]= max(dp[i - 1, j - v], dp[i - 1, j - 2v] + w, dp[i - 1, j - 3v] + 2w, ......, dp[i - 1, j - (x - 1) v] + (x - 2)w, dp[i - 1, j - xv] + (x - 1)w)
$$

（有的同学可能会问最后一个背包能承受的数量为什么还是 $x$ ，但其实那不是 $x$ ，是 $ (x - 1)v - v $ 即 $xv$ ）

然后我们惊奇地发现， $max()$ 第一项之后的 和 $dp[i,j - v]$ 是如此的相似，只差了个 $w$ ，所以我们可以把 $w$移出来，替换成

$$
dp[i, j]= max(dp[i - 1, j], dp[i][j - v] + w)
$$

## 否定

然后我们来看多重背包，我们还推式子看看（我们先假设此时 $j$ 远大于 $sv$ ）

我们先尝试能否用完全背包的方法来优化，

$$
dp[i, j]= max(dp[i - 1, j], dp[i - 1, j - v] + w, dp[i - 1, j - 2v] + 2w, ......,dp[i - 1, j - (s - 1) v] + (s - 1)w, dp[i - 1, j - sv] + sw
$$

$$
dp[i, j - v]= max(dp[i - 1, j - v], dp[i - 1, j - 2v] + w, dp[i - 1, j - 3v] + 2w, ......, dp[i - 1, j - (s - 1) v] + (s - 2)w, dp[i - 1, j - sv] + (s - 1)w)
$$

看起来似乎很对，是吗？（

但是我们考虑一下项数，我们会发下 $dp[i, j-v]$ 的项数 和 $dp[i,j]$相同，都是 $s$ 项 ，不和 $max()$ 第一项之后的 项数相同，从而不能使用之前的方法优化

## 展新

（从这一小节开始用一维数组，方便表示，没学过一维数组表示的去学一下 ）

我们还是考虑 $dp[j]$，还是列式子

$$
dp[j]= max(dp[j], dp[j - v] + w, dp[j - 2v] + 2w, ......,dp[j - (s - 1) v] + (s - 1)w, dp[j - sv] + sw
$$

我们假设 $j = (s + 2) v$

To be continued...







